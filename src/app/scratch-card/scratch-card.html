<div class="scratch-game">
	<h1 class="game-title">ğŸ° åˆ®åˆ®æ¨‚ ğŸ°</h1>

	<div class="card-wrapper">
		<div class="card" #cardContainer>
			<!-- çé‡‘åº•å±¤ -->
			<div class="prize-layer">
				@if (hasScratched() || revealed()) {
				<div class="prize-label">çé‡‘</div>
				<div class="prize-amount" [class.revealed]="revealed()">{{ prizeDisplay() }}</div>
				<div class="prize-decoration" [class.revealed]="revealed()">{{ prizeMessage() }}</div>
				} @else {
				<div class="prize-label">â“â“â“</div>
				}
			</div>
			<!-- åˆ®é™¤å±¤ Canvas -->
			<canvas
				class="scratch-canvas"
				#scratchCanvas
				[class.hidden]="revealed()"
				(pointerdown)="onPointerDown($event)"
				(pointermove)="onPointerMove($event)"
				(pointerup)="onPointerUp()"
				(pointerleave)="onPointerUp()"
			></canvas>
		</div>
	</div>

	<!-- ç¡¬å¹£é¸æ“‡å™¨ -->
	<div class="coin-selector">
		<span class="coin-label">é¸æ“‡ç¡¬å¹£ï¼š</span>
		<div class="coin-options">
			@for (coin of coins; track coin.name) {
			<button class="coin-btn" [class.active]="selectedCoin() === coin" (click)="selectCoin(coin)">
				<span class="coin-icon" [style.width.px]="coin.displaySize" [style.height.px]="coin.displaySize">
					{{ coin.icon }}
				</span>
				<span class="coin-name">{{ coin.name }}</span>
			</button>
			}
		</div>
	</div>

	<!-- åˆ®é™¤é€²åº¦ + é–‹çæŒ‰éˆ• -->
	@if (!revealed()) {
	<div class="progress-bar-container">
		<div class="progress-bar" [style.width.%]="scratchPercent()"></div>
	</div>
	<div class="scratch-actions">
		<span class="progress-text">å·²åˆ®é™¤ {{ scratchPercent() | number: '1.0-0' }}%</span>
		<button class="reveal-btn" [class.invisible]="scratchPercent() < 50" (click)="reveal()">ğŸ¯ é–‹ç</button>
	</div>
	}

	<!-- é‡æ–°é–‹å§‹ -->
	@if (revealed()) {
	<button class="restart-btn" (click)="restart()">ğŸ² å†ä¾†ä¸€å¼µ</button>
	}

	<!-- ç´¯ç©çµ±è¨ˆ -->
	<div class="stats">
		<div class="stat-item">
			<span class="stat-label">å·²ç©</span>
			<span class="stat-value">{{ totalPlays() }} æ¬¡</span>
		</div>
		<div class="stat-divider"></div>
		<div class="stat-item">
			<span class="stat-label">ç´¯ç©çé‡‘</span>
			<span class="stat-value highlight">${{ totalWinnings() | number }}</span>
		</div>
	</div>

	<!-- çé‡‘æ©Ÿç‡æŒ‰éˆ• -->
	<button class="info-btn" (click)="openPrizeTable()">ğŸ“‹ ä¸­çæ©Ÿç‡</button>

	<!-- çé‡‘æ©Ÿç‡ Dialog -->
	<dialog #prizeDialog class="prize-dialog" (click)="closePrizeTable()">
		<div class="dialog-content" (click)="$event.stopPropagation()">
			<div class="dialog-header">
				<h2>ğŸ° ä¸­çæ©Ÿç‡</h2>
				<button class="dialog-close" (click)="closePrizeTable()">âœ•</button>
			</div>
			<table class="prize-table">
				<thead>
					<tr>
						<th>çé‡‘</th>
						<th>æ©Ÿç‡</th>
					</tr>
				</thead>
				<tbody>
					@for (prize of prizes; track prize.amount) {
					<tr [class.jackpot]="prize.amount >= 1000000">
						<td class="amount-cell">${{ prize.amount | number }}</td>
						<td class="prob-cell">{{ prize.weight / totalWeight | percent: '1.2-2' }}</td>
					</tr>
					}
				</tbody>
			</table>
		</div>
	</dialog>
</div>
